!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.IngestAPI=t():e.IngestAPI=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){e.exports=o(1)},function(e,t,o){function n(e){this.defaults={host:"https://api.ingest.io",videos:"/videos",videoById:"/videos/<%=id%>",uploadSign:"/videos/<%=id%>/upload/sign<%=method%>",trash:"/videos?filter=trashed",networks:"/networks",networksKeys:"/networks/keys",networksKeysById:"/networks/keys/<%=id%>",uploadMethods:{param:"?type=",singlePart:"amazon",multiPart:"amazonMP"},deleteMethods:{permanent:"?permanent=1"},search:"/<%=resource%>?search=<%=input%>"},this.config=i(!0,{},this.defaults,e),this.config.token&&this.setToken(this.config.token),this.request=r}var r=o(2),s=o(3),i=o(7);n.prototype.setToken=function(e){if(!e||"string"!=typeof e)throw new Error("IngestAPI requires an authentication token passed as a string.");this.token=e},n.prototype.getToken=function(){if(!this.token)throw new Error("IngestAPI requires a token to be set.");return this.token},n.prototype.getVideos=function(e){return new r({url:this.config.host+this.config.videos,token:this.getToken(),headers:e})},n.prototype.getVideoById=function(e){var t,o;return e&&"string"==typeof e?(o={id:e},t=this.parseTokens(this.config.host+this.config.videoById,o),new r({url:t,token:this.getToken()})):this.promisify(!1,"IngestAPI getVideoById requires a valid videoId as a string.")},n.prototype.addVideo=function(e){return e&&"object"==typeof e?new r({url:this.config.host+this.config.videos,token:this.getToken(),method:"POST",data:e}):this.promisify(!1,"IngestAPI addVideo requires a video object.")},n.prototype.updateVideo=function(e){var t,o;return e&&"object"==typeof e?(o={id:e.id},t=this.parseTokens(this.config.host+this.config.videoById,o),new r({url:t,token:this.getToken(),method:"PATCH",data:e})):this.promisify(!1,"IngestAPI update requires a video to be passed as an object.")},n.prototype.updateVideos=function(e){return"object"!=typeof e?this.promisify(!1,"IngestAPI updateVideos requires an array of videos"):new r({url:this.config.host+this.config.videos,token:this.getToken(),method:"PATCH",data:e})},n.prototype.deleteVideos=function(e,t){var o;return"object"!=typeof e?this.promisify(!1,"IngestAPI deleteVideos requires an array of videos"):(o=this.config.host+this.config.videos,t===!0&&(o+=this.config.deleteMethods.permanent),new r({url:o,token:this.getToken(),method:"DELETE",data:e}))},n.prototype._deleteVideo=function(e,t){var o,n;return e&&"string"==typeof e?(n={id:e},o=this.parseTokens(this.config.host+this.config.videoById,n),t===!0&&(o+=this.config.deleteMethods.permanent),new r({url:o,token:this.getToken(),method:"DELETE"})):this.promisify(!1,"IngestAPI deleteVideo requires a video ID passed as a string.")},n.prototype.deleteVideo=function(e){return this._deleteVideo(e)},n.prototype.permanentlyDeleteVideo=function(e){return this._deleteVideo(e,!0)},n.prototype.searchVideos=function(e,t,o){var n;return e&&"string"==typeof e?t&&"string"==typeof t?(n=this.parseTokens(this.config.host+this.config.search,{resource:e,input:t}),new r({url:n,token:this.getToken(),headers:o})):this.promisify(!1,"IngestAPI searchVideos requires search input to be passed as a string."):this.promisify(!1,"IngestAPI searchVideos requires a resource type to be passed as a string.")},n.prototype.getVideosCount=function(){return new r({url:this.config.host+this.config.videos,token:this.getToken(),method:"HEAD"}).then(this.getCountResponse.bind(this))},n.prototype.getTrashedVideos=function(e){return new r({url:this.config.host+this.config.trash,token:this.getToken(),headers:e})},n.prototype.getTrashedVideosCount=function(){return new r({url:this.config.host+this.config.trash,token:this.getToken(),method:"HEAD"}).then(this.getCountResponse.bind(this))},n.prototype.getCountResponse=function(e){return parseInt(e.headers("Resource-Count"),10)},n.prototype.signUploadBlob=function(e){var t,o,n=this.validateUploadObject(e),s="";return n.valid?(e.method||(s=this.config.uploadMethods.param+this.config.uploadMethods.singlePart),o={id:e.id,method:s},t=this.parseTokens(this.config.host+this.config.uploadSign,o),new r({url:t,token:this.getToken(),method:"POST",data:e})):this.promisify(!1,n.message)},n.prototype.validateUploadObject=function(e){var t={valid:!0,message:""};return e&&"object"==typeof e||(t.valid=!1,t.message="The passed value was not an object."),e.id&&"string"==typeof e.id||(t.valid=!1,t.message="Missing or invalid property : id."),e.key&&"string"==typeof e.key||(t.valid=!1,t.message="Missing or invalid property : key."),e.uploadId&&"string"==typeof e.uploadId||(t.valid=!1,t.message="Missing or invalid property : uploadId"),e.partNumber&&"number"==typeof e.partNumber||(t.valid=!1,t.message="Missing or invalid property : partNumber"),e.hasOwnProperty("method")&&"boolean"==typeof e.method||(t.valid=!1,t.message="Missing or invalid property : method"),!e.hasOwnProperty("method")||e.method||e.uploadId||(t.valid=!0,t.message=""),t},n.prototype.parseTokens=function(e,t){var o,n=Object.keys(t),r=n.length;for(o=0;r>o;o++)e=e.replace("<%="+n[o]+"%>",t[n[o]]);return e},n.prototype.promisify=function(e,t){var o=s();return o(e,[t]),o},n.prototype.getNetworkSecureKeys=function(){return new r({url:this.config.host+this.config.networksKeys,token:this.getToken()})},n.prototype.addNetworkSecureKey=function(e){return"object"!=typeof e?this.promisify(!1,"IngestAPI addNetworkSecureKey requires data to be passed as an object."):("string"!=typeof e.title&&(e.title=""),"string"!=typeof e.key?this.promisify(!1,"IngestAPI addNetworkSecureKey requires that the key be a string in RSA public key format."):new r({url:this.config.host+this.config.networksKeys,token:this.getToken(),method:"POST",data:e}))},n.prototype.getNetworkSecureKeyById=function(e){var t,o;return"string"!=typeof e?this.promisify(!1,"IngestAPI getNetworkSecureKeyById requires an id to be passed as a string."):(t={id:e},o=this.parseTokens(this.config.host+this.config.networksKeysById,t),new r({url:o,token:this.getToken()}))},n.prototype.updateNetworkSecureKey=function(e){var t,o;return"object"!=typeof e?this.promisify(!1,"IngestAPI updateNetworkSecureKeyById requires data to be passed as an object."):"string"!=typeof e.id?this.promisify(!1,'IngestAPI updateNetworkSecureKeyById requires a param "id" to be a string.'):("string"!=typeof e.title&&(e.title=""),t={id:e.id},o=this.parseTokens(this.config.host+this.config.networksKeysById,t),new r({url:o,token:this.getToken(),method:"PATCH",data:e}))},n.prototype.deleteNetworkSecureKeyById=function(e){var t,o;return"string"!=typeof e?this.promisify(!1,"IngestAPI deleteNetworkSecureKeyById requires an id to be passed as a string."):(t={id:e},o=this.parseTokens(this.config.host+this.config.networksKeysById,t),new r({url:o,token:this.getToken(),method:"DELETE"}))},e.exports=n},function(e,t,o){var n=o(3),r=o(7),s=[200,201,202,204],i=function(e){return this.defaults={async:!0,method:"GET"},this.promise=n(),this.request=new XMLHttpRequest,this.setupListeners(),this.options=r(!0,this.defaults,e),this.options.url?(this.makeRequest(),this.promise):(this.requestError("Request Error : a url is required to make the request."),this.promise)};i.prototype.setupListeners=function(){this.request.onreadystatechange=this.readyStateChange.bind(this)},i.prototype.makeRequest=function(){var e=this.preparePostData(this.options.data);return e.success?(this.request.open(this.options.method,this.options.url,this.options.async),this.options.headers&&this.applyRequestHeaders(this.options.headers),this.options.token&&this.request.setRequestHeader("Authorization",this.options.token),void(e.data?(this.request.setRequestHeader("Content-type","application/json; charset=utf-8"),this.request.send(e.data)):this.request.send())):void this.requestError("Request Error : error preparing post data.")},i.prototype.preparePostData=function(e){var t={success:!0,data:e};if(e)try{t.data=JSON.stringify(e)}catch(o){t.success=!1,t.data=null}return t},i.prototype.applyRequestHeaders=function(e){var t,o,n=Object.keys(e),r=n.length;for(o=0;r>o;o++)t=n[o],this.request.setRequestHeader(t,e[t])},i.prototype.requestComplete=function(e){this.response=this.processResponse(e),this.promise(!this.response.data.error,[this.response])},i.prototype.processResponse=function(e){var t=this.request.getResponseHeader("Content-Type"),o=e;if(t&&-1!==t.indexOf("application/json"))try{o=JSON.parse(e)}catch(n){o={error:"JSON parsing failed. "+n.stack}}return{data:o,headers:this.request.getResponseHeader.bind(this.request),statusCode:this.request.status}},i.prototype.requestError=function(e){this.promise(!1,[e])},i.prototype.readyStateChange=function(){4===this.request.readyState&&(this.isValidResponseCode(this.request.status)?this.requestComplete(this.request.responseText):this.requestError("Invalid response code."))},i.prototype.isValidResponseCode=function(e){var t,o=!1,n=s.length;for(t=0;n>t;t++)if(e===s[t]){o=!0;break}return o},e.exports=i},function(e,t,o){(function(e,t,o){!function(e){function n(e){return"function"==typeof e}function r(e){return"object"==typeof e}function s(e){"undefined"!=typeof t?t(e):"undefined"!=typeof o&&o.nextTick?o.nextTick(e):setTimeout(e,0)}var i;e[0][e[1]]=function a(e){var t,o=[],u=[],p=function(e,n){return null==t&&null!=e&&(t=e,o=n,u.length&&s(function(){for(var e=0;e<u.length;e++)u[e]()})),t};return p.then=function(p,d){var c=a(e),h=function(){function e(t){var o,s=0;try{if(t&&(r(t)||n(t))&&n(o=t.then)){if(t===c)throw new TypeError;o.call(t,function(){s++||e.apply(i,arguments)},function(e){s++||c(!1,[e])})}else c(!0,arguments)}catch(a){s++||c(!1,[a])}}try{var s=t?p:d;n(s)?e(s.apply(i,o||[])):c(t,o)}catch(a){c(!1,[a])}};return null!=t?s(h):u.push(h),c},e&&(p=e(p)),p}}([e,"exports"])}).call(t,o(4)(e),o(5).setImmediate,o(6))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,o){(function(e,n){function r(e,t){this._id=e,this._clearFn=t}var s=o(6).nextTick,i=Function.prototype.apply,a=Array.prototype.slice,u={},p=0;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var o=p++,n=arguments.length<2?!1:a.call(arguments,1);return u[o]=!0,s(function(){u[o]&&(n?e.apply(null,n):e.call(null),t.clearImmediate(o))}),o},t.clearImmediate="function"==typeof n?n:function(e){delete u[e]}}).call(t,o(5).setImmediate,o(5).clearImmediate)},function(e,t){function o(){p=!1,i.length?u=i.concat(u):d=-1,u.length&&n()}function n(){if(!p){var e=setTimeout(o);p=!0;for(var t=u.length;t;){for(i=u,u=[];++d<t;)i&&i[d].run();d=-1,t=u.length}i=null,p=!1,clearTimeout(e)}}function r(e,t){this.fun=e,this.array=t}function s(){}var i,a=e.exports={},u=[],p=!1,d=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];u.push(new r(e,t)),1!==u.length||p||setTimeout(n,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t){"use strict";var o=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},s=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var t=o.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&o.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var s;for(s in e);return"undefined"==typeof s||o.call(e,s)};e.exports=function i(){var e,t,o,n,a,u,p=arguments[0],d=1,c=arguments.length,h=!1;for("boolean"==typeof p?(h=p,p=arguments[1]||{},d=2):("object"!=typeof p&&"function"!=typeof p||null==p)&&(p={});c>d;++d)if(e=arguments[d],null!=e)for(t in e)o=p[t],n=e[t],p!==n&&(h&&n&&(s(n)||(a=r(n)))?(a?(a=!1,u=o&&r(o)?o:[]):u=o&&s(o)?o:{},p[t]=i(h,u,n)):"undefined"!=typeof n&&(p[t]=n));return p}}])});
//# sourceMappingURL=ingest.js.map
<!DOCTYPE html/>
<html>
    <head>
        <title>IngestAPI Test Coverage</title>
        <script src="authToken.js"></script>
        <script src="./dist/ingest.js"></script>

    </head>
    <body>
      <h1>IngestAPI</h1>

      <h2>Test Coverage</h2>
      <ul>
        <li>
          <a href="dist/integration-coverage/index.html">Javascript Integration Test Coverage</a>
        </li>
      </ul>

      <div>
        <h2>Upload test</h2>
        <input class="file-picker" type="file" name="file" />
        <input class="btn-submit" type="submit" value="upload" />
        <input style="display: none;" class="btn-pause" type="button" value="pause" />
      </div>

      <div>
        <h2>Upload Thumbnail test</h2>
        <input type="text" class="thumbnail-video-id" placeholder="videoID" />
        <input accept="image/*" class="thumbnail-file-picker" type="file" name="file" />
        <input class="thumbnail-btn-submit" type="submit" value="upload" />
      </div>

      <script>
        var ingest = new IngestAPI({
          host: 'http://weasley.teamspace.ad:8080'
        });

        ingest.setToken('Bearer ' + window.token);

        var filePicker = document.getElementsByClassName('file-picker')[0];
        var submitbtn =  document.getElementsByClassName('btn-submit')[0];
        var pausebtn = document.getElementsByClassName('btn-pause')[0];

        var thumbnailVideoId = document.getElementsByClassName('thumbnail-video-id')[0];
        var thumbnailFilePicker = document.getElementsByClassName('thumbnail-file-picker')[0];
        var thumbnailSubmitbtn = document.getElementsByClassName('thumbnail-btn-submit')[0];

        var upload;

        submitbtn.addEventListener('click', function () {

          var file = filePicker.files[0];

          upload = ingest.upload(file);

          pausebtn.style.display = 'inline';

          upload.progress(function (percent) {
            console.log('Progress : ', percent);
          });

          // Start the upload of the file.
          upload.save().then(function (response) {
            pausebtn.style.display = 'none';
          }, function (error) {
            pausebtn.style.display = 'none';
          });

        });

        pausebtn.addEventListener('click', function (event) {

          var state = pausebtn.getAttribute('value');

          if (state === 'pause') {
            state = 'resume';
            upload.pause();
          } else {
            state = 'pause';
            upload.resume();
          }

          pausebtn.setAttribute('value', state);

        });

        thumbnailSubmitbtn.addEventListener('click', function () {

          var file = thumbnailFilePicker.files[0];
          var id = thumbnailVideoId.value;

          ingest.videos.uploadThumbnail(id, file).then(function (response) {
            console.log('Thumbnail uploaded.');
          }, function (error) {
            console.log('There was an error with your upload : ', error);
          });

          //ingest.videos.getAll().then(function (response) {
            //var items = response.data;
            //var length = items.length;
            //var i;

            //for (i = 0; i < length; i++) {

              // Todo : figure out why thumbnails are not showing up in the
              // dashboard.

              //ingest.videos.getThumbnails(items[i].id).then(function (response) {
              //  console.log(response);
              //});

              //console.log(items[i].id);
              //ingest.videos.uploadThumbnail(items[i].id, file).then(function (response) {
              //  console.log('Spam!');
              //});

            //}

          //});

        });

      </script>
    </body>
<html>
